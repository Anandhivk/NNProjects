package scrapedata;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.testng.annotations.Test;

import utility.XLUtils;



public class  Diabetesscrape extends Baseclass{

	@Test 
	public void diabetesrecipe() throws InterruptedException
	{
		WebElement recipetab = driver.findElement(By.xpath("//div[@class='menucontainer_div']"));
		WebElement helthtab=driver.findElement(By.xpath("//a[contains(@href,'focus=health')]"));
		WebElement diareacpi=driver.findElement(By.xpath("//a[contains(text(),'Delicious Diabetic Recipes')]"));
		Actions action =new Actions(driver);
		action.moveToElement(recipetab).perform(); 
		action.moveToElement(helthtab).build().perform();
		Thread.sleep(2000); 
		action.moveToElement(diareacpi).build().perform();
		diareacpi.click();
		Thread.sleep(2000); 

		//Pagination //

		List<WebElement>  Pagination =driver.findElements(By.xpath("//*[@id='pagination']/a"));
		int pagesize= Pagination.size();
		//Counting the page size
		System.out.println("pages "+pagesize);


		// xlsheet path 
		
		String path ="C:\\Users\\anand\\git\\Recipe-Scraping\\pcossheet";
		XLUtils xlutils=new XLUtils(path);

		//write headers in xlsheet
		try {
			xlutils.setCellData("Sheet1",0,0,"Recipe Id");
			xlutils.setCellData("Sheet1",0,1,"RecipeName");
			xlutils.setCellData("Sheet1", 0, 2,"Prepartion Time" );
			xlutils.setCellData("Sheet1", 0, 3,"Cook Time" );
			xlutils.setCellData("Sheet1", 0, 4," Method" );
			xlutils.setCellData("Sheet1", 0, 5,"Ingredients" );
			xlutils.setCellData("Sheet1",0,6,"Recipe URL");
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		//iteration of page
		int k=1;

		for (int j = 1; j <=2; j++) {
			System.out.println("PAGE "+j);

			Thread.sleep(1000);
			WebElement Paginator=driver.findElement(By.xpath("//*[@id='pagination']/a["+j+"]"));
			Paginator.click();
			Thread.sleep(1000);
			List<WebElement> recipecards=driver.findElements(By.xpath("//div[@class='recipelist']//article[@class='rcc_recipecard']"));
			int recipecardno=recipecards.size();
			System.out.println(recipecardno);

			//	//iteration of recipe cards
			for(int i=1;i<=recipecardno;i++)
			{    
				try {


					String recipeId=driver.findElement(By.xpath("//article[@class='rcc_recipecard']["+i+"]//div[@class='rcc_rcpno']//span[contains(text(),'Recipe#')]")).getText();
					String recUrl=driver.findElement(By.xpath("//article[@class='rcc_recipecard']["+i+"]//div[@class='rcc_rcpcore']//span[@class='rcc_recipename']//a")).getAttribute("href");

					WebElement recipeLinks = driver.findElement(By.xpath("//div[@class='recipelist']//article["+i+"]//span[@itemprop='name']//a[@itemprop='url']"));
					recipeLinks.click();
					Thread.sleep(1000);
					String recipeName= driver.findElement(By.xpath("//span[@id='ctl00_cntrightpanel_lblrecipeNameH2']")).getText();
					String prepartionTime=driver.findElement(By.xpath("//time[@itemprop='prepTime']")).getText();
					String cookingTime = driver.findElement(By.xpath("//time[@itemprop='cookTime']")).getText();
					String prepMethod = driver.findElement(By.xpath("//div[@id='ctl00_cntrightpanel_pnlRcpMethod']//div[@id='recipe_small_steps']")).getText();
					String ingredients = driver.findElement(By.xpath("//div[@id='recipe_ingredients']")).getText();
					//printing on console
					Thread.sleep(1000);
					System.out.println("Recipe Name:----- "+recipeName);
					System.out.println("Preapartion Time:----- "+prepartionTime);
					System.out.println("Cooking Time:-----  "+cookingTime);
					System.out.println("Prepartion Method: ----- "+prepMethod);
					System.out.println("Ingredients :-----  "+ingredients);
					System.out.println("******************************************************************************");
					//inserting data into xlsheet cell
					xlutils.setCellData("Sheet1", k, 0,recipeId );
					xlutils.setCellData("Sheet1", k, 1, recipeName);
					xlutils.setCellData("Sheet1", k, 2, prepartionTime);
					xlutils.setCellData("Sheet1", k, 3, cookingTime);
					xlutils.setCellData("Sheet1", k, 4, prepMethod);
					xlutils.setCellData("Sheet1", k, 5, ingredients);
					xlutils.setCellData("Sheet1", k, 6, recUrl);

					k++;
					driver.navigate().back();

				} catch (Exception e) {
					e.printStackTrace();

				}




			}




			////article[@class='rcc_recipecard']//div[@class='rcc_rcpno']//span  for id 
			////article[@class='rcc_recipecard']//span[@class='rcc_recipename']//for url





		}



	}
}


